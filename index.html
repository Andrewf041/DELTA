<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DELTA</title>
<link rel="manifest" href="manifest.json">
<style>
:root{
  --bg:#0b0d14;--panel:#12162a;--ink:#e8ebff;
  --u:#7aa2ff;--d:#8dffb2;--sys:#ffd479;
}
*{box-sizing:border-box}
body{
  margin:0;height:100vh;
  background:radial-gradient(1200px 800px at 50% -20%, #182055, var(--bg));
  color:var(--ink);font-family:system-ui,Arial,sans-serif;
  display:flex;flex-direction:column;
}
header{
  padding:14px;text-align:center;font-size:22px;
  letter-spacing:.12em;
  background:linear-gradient(180deg,#1a1f4a,var(--panel));
}
# chat{flex:1;padding:12px;overflow-y:auto}
.msg{margin-bottom:10px;line-height:1.45}
.user{color:var(--u)}
.delta{color:var(--d)}
.system{color:var(--sys)}
footer{
  padding:10px;background:linear-gradient(180deg,var(--panel),#0f1330);
}
input,button{
  width:100%;padding:12px;font-size:16px;
  border-radius:10px;border:1px solid #2a2f66;
  background:#0b0e22;color:#fff;margin-top:6px;
}
button{background:#1a1f4a}
small{opacity:.7}
</style>
</head>

<body>
<header>DELTA</header>
<div id="chat"></div>
<footer>
  <input id="input" placeholder="–ù–∞–ø–∏—à–∏, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ‚Ä¶" />
  <button onclick="exportChat()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∏–∞–ª–æ–≥</button>
  <small>–ò–Ω—Ç–µ—Ä–Ω–µ—Ç ‚Äî —Ç–æ–ª—å–∫–æ —Å –¥–≤–æ–π–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è</small>
</footer>

<script>
// ===== –ü–ê–ú–Ø–¢–¨ =====
const STORE="DELTA_MEMORY_V5";
let memory=JSON.parse(localStorage.getItem(STORE)||"[]");
function save(){localStorage.setItem(STORE,JSON.stringify(memory))}
function remember(r,t){memory.push({r,t});if(memory.length>100)memory.shift();save()}

// ===== UI =====
const chat=document.getElementById("chat");
const input=document.getElementById("input");
function add(text,cls,speak=false){
  const d=document.createElement("div");
  d.className="msg "+cls;d.textContent=text;
  chat.appendChild(d);chat.scrollTop=chat.scrollHeight;
  if(speak&&cls==="delta") speakText(text.replace("DELTA: ",""));
}

// ===== –ì–û–õ–û–° =====
function speakText(text){
  if(!("speechSynthesis"in window))return;
  const u=new SpeechSynthesisUtterance(text);
  u.lang="ru-RU";speechSynthesis.speak(u);
}

// ===== –≠–ö–°–ü–û–†–¢ =====
function exportChat(){
  const txt=memory.map(m=>(m.r==="user"?"–¢—ã":"DELTA")+": "+m.t).join("\n");
  const blob=new Blob([txt],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="delta_chat.txt";a.click();
}

// ===== –õ–û–ì–ò–ö–ê =====
let net1=false,net2=false,pending="";
let game=null,secret=0;

add(memory.length?"DELTA: –Ø –ø–æ–º–Ω—é –ø—Ä–æ—à–ª—ã–π –¥–∏–∞–ª–æ–≥.":"DELTA: –Ø –≥–æ—Ç–æ–≤.", "delta", true);

input.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&input.value.trim()){
    const t=input.value.trim();input.value="";
    add("–¢—ã: "+t,"user");remember("user",t);
    route(t);
  }
});

function route(text){
  const low=text.toLowerCase();

  // –∏–Ω—Ç–µ—Ä–Ω–µ—Ç ‚Äî –¥–≤–æ–π–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
  if(net1){
    if(low==="–¥–∞"){net1=false;net2=true;add("DELTA: –¢–æ—á–Ω–æ –¥–∞—ë—à—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ?","delta",true)}
    else{resetNet();add("DELTA: –•–æ—Ä–æ—à–æ, –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.","delta",true)}
    return;
  }
  if(net2){
    if(low==="–¥–∞, —Ç–æ—á–Ω–æ –¥–∞"){
      net2=false;
      add("DELTA: –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ. (–æ–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω)","system");
      add("DELTA: –û—Ç–≤–µ—Ç –ø–æ —Ç–µ–º–µ: "+pending,"delta",true);
      remember("delta",pending);
    }else{resetNet();add("DELTA: –û—Ç–º–µ–Ω–µ–Ω–æ.","delta",true)}
    return;
  }
  if(low.includes("–Ω–∞–π–¥–∏")||low.includes("–∏–Ω—Ç–µ—Ä–Ω–µ—Ç")){
    pending=text;net1=true;
    add("DELTA: –ú–Ω–µ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. –ú–æ–∂–Ω–æ –ª–∏?","delta",true);
    return;
  }

  // –∏–≥—Ä—ã
  if(low.includes("–∏–≥—Ä–∞")){
    game="number";secret=Math.floor(Math.random()*10)+1;
    add("DELTA: –Ø –∑–∞–≥–∞–¥–∞–ª —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10. –£–≥–∞–¥–∞–π.","delta",true);
    return;
  }
  if(game){
    const n=parseInt(low);
    if(n===secret){add("DELTA: –í–µ—Ä–Ω–æ!","delta",true);game=null}
    else add("DELTA: –ù–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë.","delta",true);
    return;
  }

  // –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º
  add("DELTA: –Ø —Å —Ç–æ–±–æ–π. –ü–∏—à–∏, —á—Ç–æ –Ω—É–∂–Ω–æ.","delta",true);
}

function resetNet(){net1=net2=false;pending=""}

// ===== PWA =====
if("serviceWorker"in navigator){navigator.serviceWorker.register("sw.js")}
</script>
</body>
</html>
